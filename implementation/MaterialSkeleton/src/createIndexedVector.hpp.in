#ifndef ENDFTK_IMPLEMENTATION_MATERIALSKELETON_SRC_CREATEINDEXEDVECTOR_HPP
#define ENDFTK_IMPLEMENTATION_MATERIALSKELETON_SRC_CREATEINDEXEDVECTOR_HPP

#include "ENDFtk.hpp"

namespace ENDFtk {
namespace implementation {

template<typename Iterator>
std::vector<FileSkeleton<Iterator> > 
MaterialSkeleton<Iterator>::createIndexedVector(
  const HeadRecord& head,
  Iterator begin, Iterator& position, const Iterator& end, 
  long& LN ){
    std::vector<FileSkeleton_t > SI;

    try{
      SI.push_back(
        FileSkeleton_t(head, begin, position, end, LN) );

      auto MEND = StructureDivision(position, end, LN); 

      while( not MEND.isMend() ){
        if(position >= end){
          LOG(ERROR) << "Material encountered end of stream before reading MEND";
          throw std::exception();
        }
        SI.push_back(
          FileSkeleton_t(asHead(MEND), 
                                    begin, position, end, LN) );

        begin = position;
        MEND = StructureDivision(position, end, LN); 
      }
    } catch( std::exception& e ){
      LOG(INFO) << "Trouble when populating the MaterialSkeleton index";
      throw e;
    }

    return SI;
}

} // namespace implementation
} // namespace ENDFtk
#endif  // ENDFTK_IMPLEMENTATION_MATERIALSKELETON_SRC_CREATEINDEXEDVECTOR_HPP

