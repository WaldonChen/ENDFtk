#define CATCH_CONFIG_MAIN

#include "catch.hpp"

#include "ENDFtk.hpp"

using namespace njoy::ENDFtk::ResonanceParameters;

SCENARIO( "Testing Resolved Resonance RML SpinGroup" ){
  GIVEN( "valid ENDF" ){
    std::string ENDF{
      " 1.000000+0 0.000000+0          0          0         18          31725 2151   12\n"
      " 1.000000+0 0.000000+0 0.000000+0 0.000000+0 0.000000+0 0.000000+01725 2151   13\n"
      " 2.000000+0 0.000000+0 1.000000+0 0.000000+0 3.667980-1 4.822220-11725 2151   14\n"
      " 3.000000+0 0.000000+0 1.000000+0 0.000000+0 3.667980-1 4.822220-11725 2151   15\n"
      " 0.000000+0 0.000000+0          0         23        138         231725 2151   16\n"
      " 5.493200+4 3.672600-1 4.644240+1 0.000000+0 0.000000+0 0.000000+01725 2151   17\n"
      " 6.823616+4 3.933600-1 2.179040+2 1.000000-5 0.000000+0 0.000000+01725 2151   18\n"
      " 1.150980+5 7.390000-1 4.307780+0 0.000000+0 0.000000+0 0.000000+01725 2151   19\n"
      " 1.825230+5 7.451500-1 1.759740+3 4.000000-1 0.000000+0 0.000000+01725 2151   20\n"
      " 2.397427+5 6.871600-1 2.685470+2 0.000000+0 0.000000+0 0.000000+01725 2151   21\n"
      " 3.351287+5 3.583800-1 5.525660+3 0.000000+0 0.000000+0 0.000000+01725 2151   22\n"
      " 3.991469+5 7.409700-1 1.093810+3 0.000000+0 0.000000+0 0.000000+01725 2151   23\n"
      " 4.156650+5 3.286800-1 1.146260+3 0.000000+0 0.000000+0 0.000000+01725 2151   24\n"
      " 4.506303+5 3.929900-1 4.613320+2 0.000000+0 0.000000+0 0.000000+01725 2151   25\n"
      " 4.997896+5 6.704600-1 2.312410+3 0.000000+0 0.000000+0 0.000000+01725 2151   26\n"
      " 5.422214+5 6.060000-1 5.220340+2 0.000000+0 0.000000+0 0.000000+01725 2151   27\n"
      " 6.542074+5 6.060000-1 5.186030+2 0.000000+0 0.000000+0 0.000000+01725 2151   28\n"
      " 6.652896+5 6.060000-1 1.406720+2 0.000000+0 0.000000+0 0.000000+01725 2151   29\n"
      " 6.723573+5 6.060000-1 5.754080+2 0.000000+0 0.000000+0 0.000000+01725 2151   30\n"
      " 6.780000+5 6.060000-1 1.331580+2 0.000000+0 0.000000+0 0.000000+01725 2151   31\n"
      " 6.949358+5 6.060000-1 1.824950+3 0.000000+0 0.000000+0 0.000000+01725 2151   32\n"
      " 7.251773+5 6.060000-1 1.672450+2 0.000000+0 0.000000+0 0.000000+01725 2151   33\n"
      " 7.546912+5 6.060000-1 2.690680+3 0.000000+0 0.000000+0 0.000000+01725 2151   34\n"
      " 7.814646+5 6.060000-1 1.294130+3 0.000000+0 0.000000+0 0.000000+01725 2151   35\n"
      " 8.315787+5 8.600000-1 4.453040+2 0.000000+0 0.000000+0 0.000000+01725 2151   36\n"
      " 8.829776+5 6.060000-1 9.780610+2 0.000000+0 0.000000+0 0.000000+01725 2151   37\n"
      " 1.109188+6 6.060000-1 2.742350+3 0.000000+0 0.000000+0 0.000000+01725 2151   38\n"
      " 1.205687+6 6.060000-1 6.425840+2 0.000000+0 0.000000+0 0.000000+01725 2151   39\n"};
    auto begin = ENDF.begin();
    auto end = ENDF.end();
    long lineNumber = 0;
    int MAT = 1725;
    int MF = 2;
    int MT = 151;

    THEN( "a SpinGroup can be created from the string" ){
      Resolved::RMatrixLimited::SpinGroup spinGroup( begin, end, lineNumber,
                                                     MAT, MF, MT );

      AND_THEN( "some parameters can be verified" ){
        REQUIRE( 0 == spinGroup.KBK );
        REQUIRE( 0 == spinGroup.KBK );
      }
    }
    THEN( "a SpinGroup can be created from two LIST Records" ){
      njoy::ENDFtk::LIST channelDescriptions( begin, end, lineNumber, MAT, MF, MT );
      njoy::ENDFtk::LIST resonanceEnergyWidths( begin, end, lineNumber, MAT, MF, MT );

      Resolved::RMatrixLimited::SpinGroup spinGroup( 
          std::forward<njoy::ENDFtk::LIST>(channelDescriptions),
          std::forward<njoy::ENDFtk::LIST>(resonanceEnergyWidths) );

      AND_THEN( "some parameters can be verified" ){
        REQUIRE( 0 == spinGroup.KBK );
        REQUIRE( 0 == spinGroup.KBK );
      }
    }
  }
}
